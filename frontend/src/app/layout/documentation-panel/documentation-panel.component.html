<div class="flex flex-col h-full text-slate-200">
    <!-- Header -->
    <div class="p-4 border-b border-slate-700 flex items-center justify-between bg-slate-900">
        <div class="flex items-center gap-2">
            <i class="pi pi-book text-indigo-400"></i>
            <h2 class="font-semibold text-lg">Unity Docs</h2>
        </div>
        <button pButton icon="pi pi-times" (click)="close()"
            class="p-button-text p-button-rounded p-button-sm text-slate-400 hover:text-white"></button>
    </div>

    <!-- Search Bar -->
    <div class="p-4 bg-slate-800/50">
        <div class="flex gap-2">
            <input pInputText [(ngModel)]="searchQuery" placeholder="Search Unity Manual & Scripting API..."
                class="w-full bg-slate-900 border-slate-700 text-sm" (keydown.enter)="search()">
            <button pButton icon="pi pi-search" (click)="search()" [loading]="loading" class="p-button-indigo"></button>
        </div>
    </div>

    <!-- Tabs -->
    <div class="flex border-b border-slate-700 bg-slate-800/30">
        <button (click)="activeTab = 'search'" class="flex-1 py-3 text-sm font-medium transition-colors border-b-2"
            [class.border-indigo-500]="activeTab === 'search'" [class.text-indigo-400]="activeTab === 'search'"
            [class.border-transparent]="activeTab !== 'search'" [class.text-slate-400]="activeTab !== 'search'">
            Search Results
        </button>
        <button (click)="activeTab = 'pinned'" (click)="loadPinnedDocs()"
            class="flex-1 py-3 text-sm font-medium transition-colors border-b-2"
            [class.border-indigo-500]="activeTab === 'pinned'" [class.text-indigo-400]="activeTab === 'pinned'"
            [class.border-transparent]="activeTab !== 'pinned'" [class.text-slate-400]="activeTab !== 'pinned'">
            Pinned ({{ pinnedDocs.length }})
        </button>
    </div>

    <!-- Content -->
    <div class="flex-1 overflow-y-auto p-4 space-y-4 custom-scrollbar">

        <!-- Search Results -->
        <div *ngIf="activeTab === 'search'">
            <div *ngIf="loading" class="flex justify-center py-8">
                <p-progressSpinner styleClass="w-8 h-8" strokeWidth="4"></p-progressSpinner>
            </div>

            <div *ngIf="!loading && searchResults.length === 0 && searchQuery && activeTab === 'search'"
                class="text-center py-8 text-slate-500">
                <p>No results found.</p>
            </div>

            <!-- Recent History (only show if no search results yet) -->
            <div *ngIf="!loading && searchResults.length === 0 && !searchQuery && searchHistory.length > 0">
                <h3 class="text-xs font-semibold text-slate-500 uppercase mb-2">Recent Searches</h3>
                <div class="space-y-1">
                    <button *ngFor="let item of searchHistory" (click)="useHistory(item.query)"
                        class="w-full text-left px-3 py-2 rounded hover:bg-slate-800 text-sm text-slate-300 flex items-center gap-2 transition-colors">
                        <i class="pi pi-history text-xs text-slate-500"></i>
                        {{ item.query }}
                    </button>
                </div>
            </div>

            <div class="space-y-4">
                <div *ngFor="let result of searchResults"
                    class="bg-slate-800 p-3 rounded hover:bg-slate-700/80 transition-colors group relative">
                    <a [href]="result.link" target="_blank" class="block">
                        <h3 class="text-indigo-400 font-medium text-sm mb-1 hover:underline" [innerHTML]="result.title">
                        </h3>
                        <div class="text-xs text-slate-400 mb-2 line-clamp-2" [innerHTML]="result.snippet"></div>
                        <div class="text-[10px] text-slate-500 truncate">{{ result.link }}</div>
                    </a>
                    <button (click)="pinResult(result)" pTooltip="Pin to Project" tooltipPosition="left"
                        class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 bg-slate-900 text-slate-400 hover:text-indigo-400 w-8 h-8 rounded flex items-center justify-center transition-all shadow-lg">
                        <i class="pi pi-bookmark"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Pinned Docs -->
        <div *ngIf="activeTab === 'pinned'">
            <div *ngIf="pinnedDocs.length === 0" class="text-center py-8 text-slate-500">
                <i class="pi pi-bookmark text-3xl mb-2"></i>
                <p>No documentation pinned yet.</p>
                <p class="text-xs mt-1">Search and pin useful docs for your team.</p>
            </div>

            <div class="space-y-3">
                <div *ngFor="let doc of pinnedDocs"
                    class="bg-slate-800 p-3 rounded hover:bg-slate-700/80 transition-colors group relative">
                    <a [href]="doc.url" target="_blank" class="block">
                        <h3 class="text-indigo-400 font-medium text-sm mb-1 hover:underline">{{ doc.title }}</h3>
                        <div class="text-xs text-slate-400 mb-2 line-clamp-2">{{ doc.description }}</div>
                    </a>
                    <div class="flex items-center justify-between mt-2 pt-2 border-t border-slate-700/50">
                        <span class="text-[10px] text-slate-500">Pinned by {{ doc.savedByName }}</span>
                        <button (click)="unpinDoc(doc.id)" class="text-slate-500 hover:text-red-400 transition-colors">
                            <i class="pi pi-trash text-xs"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>