<nav class="bg-gray-900 border-b border-gray-800 px-4 py-3 flex items-center justify-between sticky top-0 z-50">
    <div class="flex items-center gap-6">
        <a routerLink="/" class="flex items-center gap-2 no-underline">
            <img src="assets/logo.svg" alt="Logo" class="h-8 w-8" onerror="this.style.display='none'">
            <span
                class="text-xl font-bold bg-gradient-to-r from-primary-400 to-primary-600 bg-clip-text text-transparent">
                UnityDevHub
            </span>
        </a>

        <div class="hidden md:flex items-center gap-1">
            <a routerLink="/projects" routerLinkActive="bg-gray-800 text-primary-400"
                class="px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:text-white hover:bg-gray-800 transition-colors">
                Projects
            </a>
        </div>
    </div>

    <div class="flex items-center gap-3">
        <!-- Docs Toggle -->
        <button pButton icon="pi pi-book"
            class="p-button-rounded p-button-text text-slate-300 hover:text-white hover:bg-slate-700"
            (click)="docService.togglePanel()" pTooltip="Unity Docs" tooltipPosition="bottom">
        </button>

        <!-- Theme Toggle -->
        <button pButton [icon]="themeService.isDark() ? 'pi pi-sun' : 'pi pi-moon'"
            class="p-button-rounded p-button-outlined text-white hover:bg-slate-700 border-slate-600"
            (click)="toggleTheme()">
        </button>

        <!-- Notifications -->
        <div class="relative">
            <button pButton icon="pi pi-bell"
                class="p-button-rounded p-button-text text-slate-300 hover:text-white hover:bg-slate-700"
                (click)="op.toggle($event)">
                <p-badge *ngIf="unreadCount() > 0" [value]="unreadCount().toString()" severity="danger"
                    styleClass="absolute -top-1 -right-1"></p-badge>
            </button>

            <p-overlayPanel #op [style]="{width: '350px'}" styleClass="bg-gray-900 border border-gray-700 shadow-xl">
                <ng-template pTemplate>
                    <div class="flex items-center justify-between mb-3 pb-2 border-b border-gray-700">
                        <h3 class="font-semibold text-white">Notifications</h3>
                        <button *ngIf="unreadCount() > 0" (click)="markAllRead()"
                            class="text-xs text-primary-400 hover:text-primary-300">
                            Mark all read
                        </button>
                    </div>

                    <div class="max-h-96 overflow-y-auto flex flex-col gap-2">
                        <div *ngIf="notifications().length === 0" class="text-center py-4 text-gray-500 text-sm">
                            No notifications
                        </div>

                        <div *ngFor="let notification of notifications()"
                            class="p-3 rounded-md transition-colors relative group"
                            [ngClass]="{'bg-gray-800': !notification.isRead, 'hover:bg-gray-800/50': notification.isRead}">
                            <div class="flex gap-3">
                                <i [class]="getNotificationIcon(notification.type) + ' mt-1'"></i>
                                <div class="flex-1 min-w-0">
                                    <p class="text-sm font-medium text-white truncate">{{ notification.title }}</p>
                                    <p class="text-xs text-gray-400 mt-0.5 line-clamp-2">{{ notification.message }}
                                    </p>
                                    <p class="text-[10px] text-gray-500 mt-1">{{ notification.createdAt |
                                        date:'short'
                                        }}</p>
                                </div>
                                <div class="flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                    <button *ngIf="!notification.isRead" (click)="markAsRead(notification.id, $event)"
                                        class="text-primary-400 hover:text-primary-300" title="Mark as read">
                                        <i class="pi pi-check text-xs"></i>
                                    </button>
                                    <button (click)="deleteNotification(notification.id, $event)"
                                        class="text-red-400 hover:text-red-300" title="Delete">
                                        <i class="pi pi-trash text-xs"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </ng-template>
            </p-overlayPanel>
        </div>

        <!-- User Menu -->
        <div *ngIf="currentUser() as user"
            class="flex items-center gap-2 cursor-pointer p-1 rounded-full hover:bg-gray-800 transition-colors"
            (click)="userMenu.toggle($event)">
            <p-avatar [image]="user.avatarUrl" [label]="user.displayName?.charAt(0)" shape="circle" size="normal"
                styleClass="bg-primary-600 text-white"></p-avatar>
            <span class="hidden md:block text-sm font-medium text-white max-w-[100px] truncate">{{
                user.displayName }}</span>
            <i class="pi pi-chevron-down text-xs text-gray-400"></i>
        </div>
        <p-menu #userMenu [model]="userMenuItems" [popup]="true" styleClass="w-48"></p-menu>
    </div>
</nav>